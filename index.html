<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />

        <title>Milky & Schoki</title>

        <!--http://www.html5rocks.com/en/mobile/mobifying/-->
        <meta
            name="viewport"
            content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1,minimal-ui=true"
        />

        <!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="format-detection" content="telephone=no" />

        <!-- force webkit on 360 -->
        <meta name="renderer" content="webkit" />
        <meta name="force-rendering" content="webkit" />
        <!-- force edge on IE -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="msapplication-tap-highlight" content="no" />

        <!-- force full screen on some browser -->
        <meta name="full-screen" content="yes" />
        <meta name="x5-fullscreen" content="true" />
        <meta name="360-fullscreen" content="true" />

        <!--fix fireball/issues/3568 -->
        <!--<meta name="browsermode" content="application">-->
        <meta name="x5-page-mode" content="app" />

        <link rel="apple-touch-icon" href="./icon192.png" />
        <!--<link rel="apple-touch-icon-precomposed" href=".png" />-->

        <!-- <link rel="stylesheet" type="text/css" href="style.3c663.css"/> -->
        <link rel="stylesheet" type="text/css" href="./style.css" />
        <link rel="stylesheet" type="text/css" href="./customCss.css" />

        <!-- Add to homescreen-->
        <link rel="manifest" href="./gameManifest.json" />
        <link rel="icon" href="./favicon32.png" />

        <!-- Share FB-->
        <meta property="og:url" content="https://maxi-beta.kinder.com"/>
		<meta property="og:image" content="https://maxi-beta.kinder.com/img/fb_thumbnail.jpg"/>
        <meta property="og:image:width" content="256"/>
        <meta property="og:image:height" content="256"/>
        <meta property="og:title" content="Milky & Schoki trip"/>
        <meta property="og:description" content="Milky & Schoki trip"/>

        <!-- Google Tag Manager BETA-PRODUCTION-->
        <script>
            (function (w, d, s, l, i) {
                w[l] = w[l] || [];
                w[l].push({
                    "gtm.start": new Date().getTime(),
                    event: "gtm.js",
                });
                var f = d.getElementsByTagName(s)[0],
                    j = d.createElement(s),
                    dl = l != "dataLayer" ? "&l=" + l : "";
                j.async = true;
                j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
                f.parentNode.insertBefore(j, f);
            })(window, document, "script", "dataLayer", "GTM-P55SG9R");
        </script>
        <!-- End Google Tag Manager -->
    </head>
    <body>
        <!-- Google Tag Manager (noscript) BETA-PRODUCTION -->
        <noscript
            ><iframe
                src="https://www.googletagmanager.com/ns.html?id=GTM-P55SG9R"
                height="0"
                width="0"
                style="display: none; visibility: hidden"
            ></iframe
        ></noscript>
        <!-- End Google Tag Manager (noscript) -->
        <script src="libs/zxing-browser.min.js"></script>
        <img
        id="fbThumbnail"
        src="./img/fb_thumbnail.jpg" style="display:none"
        />
        <video id="video" style="position: fixed; left: 0px"></video>
        <div id="GameDiv">
            <div id="Cocos3dGameContainer">
                <canvas
                    id="GameCanvas"
                    oncontextmenu="event.preventDefault()"
                    tabindex="0"
                ></canvas>

                <!-- START QR Scan Screen -->
                <div id="btnHome">
                    <img src="./img/qrScan/home_icon.png" />
                </div>
                <div id="scanFrame">
                    <img id="scanSquare" src="./img/qrScan/scan_square.png" />
                    <img id="scanLine" src="./img/qrScan/scan_anim.png" />
                </div>
                <div id="panelReward">
                    <div id="textScanGuide1" class="gameLabel">
                        Align QR code within the frame to scan
                    </div>
                    <img
                        id="panelRewardBg"
                        src="./img/qrScan/scan_rewards_board.png"
                    />
                    <div class="outer">
                        <div class="inner">
                            <div id="coinReward" class="rewardItem">
                                <img src="./img/qrScan/reward_coin.png" />
                                <div
                                    id="coinRewardLabel"
                                    class="rewardName gameLabel"
                                >
                                    +1000
                                </div>
                            </div>
                            <div id="boosterReward" class="rewardItem">
                                <img src="./img/qrScan/reward_booster.png" />
                                <div class="imgText gameLabel">
                                    <p>?</p>
                                </div>
                                <div
                                    id="boosterRewardLabel"
                                    class="rewardName gameLabel"
                                >
                                    A booster
                                </div>
                            </div>
                            <div id="accessoriesReward" class="rewardItem">
                                <img src="./img/qrScan/Footwear_01.png" />
                                <div class="imgText gameLabel">
                                    <p>?</p>
                                </div>
                                <div
                                    id="accessoriesRewardLabel"
                                    class="rewardName gameLabel"
                                >
                                    An outfit
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="textScanGuide2" class="gameLabel">
                        Scan another product to receive:
                    </div>
                </div>
                <!-- END QR Scan Screen -->
                <img id="img-download" />
                <img id="tutorial-image" src="./img/hand.png" />
                <div id="tutorial-title"></div>

                <div class="wrapPopup" id="wrapPopup" style="display: none">
                    <!-- <img id="popup-background" class="popup-background" src="" /> -->
                    <div class="popup-container" id="popup">
                        <div class="title-div">
                            <p class="popup-title" id="popup-title">
                                LANDSCAPE IS UNSUPPORTED
                            </p>
                        </div>
                        <!-- <p class="popup-description" id="popup-description">
                            Sorry. It seems this browser does not meet the requirements
                            to access and play with this Web AR. Please coppy the url
                            and paste on the supported browsers below:
                            <br />Safari <br />Chrome <br />Yandex <br />Opera
                            <br />Edge <br />Firefox
                        </p> -->
                    </div>
                </div>
            </div>
        </div>

        <script src="ua-parser.min.js"></script>
        <script src="platform.js"></script>
        <script src="tracking.js"></script>
        <!-- <script src="uuidv4.js"></script> -->
        <script>
            if (window.location.href.includes('test') || window.location.href.includes('localhost') || window.location.href.includes('alpha') ) {
                window.IS_DEBUG = true;
            } else {
                window.IS_DEBUG = false;
            }
            window.gameShareUrl = "https://maxi-beta.kinder.com/";

            // window.fps, window.fpsMin, window.fpsMax, window.fpsAvg, window.totalFps;
            // window.requestTime;
            window.framesCount = 0;
            window.isInAP = false;
            window.fpsOut = document.getElementById('fpsTrack');
            window.fps = 60;

            function loop(time) {
                if (window.requestTime) {
                    window.fps = Math.round(1000/((performance.now() - window.requestTime)));
                    // console.log(window.fps);
                    if (window.isInAP) {
                        if (!window.fpsMin) window.fpsMin = window.fps;
                        if (!window.fpsMax) window.fpsMax = window.fps;

                        if (window.fps < window.fpsMin) window.fpsMin = window.fps;
                        if (window.fps > window.fpsMax) window.fpsMax = window.fps;

                        window.framesCount++;
                        if (!window.totalFps) {
                            window.totalFps = window.fps;
                        } else {
                            window.totalFps += window.fps;
                        }
                        window.fpsAvg = Math.round(window.totalFps / window.framesCount);
                    }
                }
                window.requestTime = time;

                window.requestAnimationFrame((timeRes) => {
                    loop(timeRes)}
                );
            }
            window.requestAnimationFrame((timeRes) => {
                loop(timeRes)}
            );
            // var fpsOut = document.getElementById('fpsTrack');
            // setInterval(function(){
            //     fpsOut.innerHTML = 'fps: ' + fpsAvg + ' - fpsMin: ' + fpsMin + ' - fpsMax: ' + fpsMax;
            // },1000);
            

            var manufacturer = platform.manufacturer;

            // get the browser name
            var nAgt = navigator.userAgent;
            var browserName = navigator.appName;

            console.log("User agent = " + nAgt);
            if ((verOffset = nAgt.indexOf("Maxthon")) != -1) {
                browserName = "Maxthon";
            } else if (
                (verOffset = nAgt.indexOf("Opera")) != -1 ||
                (verOffset = nAgt.indexOf("OPR/")) != -1 ||
                (verOffset = nAgt.indexOf("OPT/")) != -1
            ) {
                browserName = "Opera";
            } else if ((verOffset = nAgt.indexOf("coc_coc")) != -1) {
                browserName = "Coc Coc";
            } else if (
                (verOffset = nAgt.indexOf("Firefox")) != -1 ||
                (verOffset = nAgt.indexOf("FxiOS/")) != -1
            ) {
                browserName = "Firefox";
            } else if ((verOffset = nAgt.indexOf("MSIE")) != -1) {
                browserName = "Microsoft Internet Explorer";
            } else if (
                (verOffset = nAgt.indexOf("Chrome")) != -1 ||
                (verOffset = nAgt.indexOf("CriOS/")) != -1
            ) {
                browserName = "Chrome";
            } else if ((verOffset = nAgt.indexOf("Safari")) != -1) {
                browserName = "Safari";
            }
            // In most other browsers, "name/version" is at the end of userAgent
            else if (
                (nameOffset = nAgt.lastIndexOf(" ") + 1) <
                (verOffset = nAgt.lastIndexOf("/"))
            ) {
                browserName = nAgt.substring(nameOffset, verOffset);
                if (browserName.toLowerCase() == browserName.toUpperCase()) {
                    browserName = navigator.appName;
                }
            }
            // end browser name

            // get info device
            function getUserAgent() {
                var UA = new UAParser();
                UA.setUA(navigator.userAgent);
                return UA.getResult();
            }

            var UA = this.getUserAgent();
            var keys = [];
            var osVersion;
            if (UA.os.version) {
                var osVersionDetail = UA.os.version.split(".");
                osVersion = osVersionDetail[0];
                osVersionDetail[1] && (osVersion += "." + osVersionDetail[1]);
            } else osVersion = undefined;

            UAosname = UA.os.name;
            USosVersion = osVersion;
            UAdevicetype = UA.device.type;
            UAdevicevendor = UA.device.vendor;
            UAdevicemodel = UA.device.model;
            UAbrowsername = UA.browser.name;
            console.log("UA.os.name " + UAosname);
            console.log("osVersion " + USosVersion);
            console.log("UA.device.type " + UAdevicetype);
            console.log("UA.device.vendor " + UAdevicevendor);
            console.log("UA.device.model " + UAdevicemodel);
            console.log("UA.browser.name " + UAbrowsername);
            window.d_os = UAosname;
            // end info device

            window.isLowEndAndroid = UA.os.name == "Android" && Number.parseFloat(osVersion) < 9;
            console.log("isLowEndAndroid", window.isLowEndAndroid);

            // code to get params for tracking and send event LAUNCH_RESUME at Loading
            var mTracking = new tracking();

            try {
                mTracking.Init();
            } catch (error) {
                console.error(error);
            }

            var launch_source = "425979"; // WEB LINK by default
            var package_name = "";

            // CHECK URL
            console.log("checking host login");
            const ALPHA = "alpha";
            const BETA = "beta";
            const SNS_LOGIN_CODE = "sns-login-code";
            const CODE_NAME = "code";
            const QR_CODE_NAME = "code";
            const INVITE_CODE_NAME = "invcode";
            const FB_CODE_NAME = "isfb";
            const YTB_CODE_NAME = "isytb";
            const DEFAULT_QR_CODE = "KM001";

            let targetOrigin = window.location.origin;
            const host = window.location.host;
            if (host.includes(ALPHA) || host.startsWith(BETA)) {
                targetOrigin = "*";
            }
            console.log("targetOrigin", targetOrigin);
            console.log("host", host);


            // PWA STANDALONE CHECK
            // Solution 1: Check if the app is running in standalone mode
            window.isInStandaloneMode = false;
            let displayMode = 'browser';
            const mqStandAlone = '(display-mode: standalone)';
            if (navigator.standalone || window.matchMedia(mqStandAlone).matches) {
                displayMode = 'standalone';
            }
            console.log("displayMode", displayMode);

            // Solution 2: Check if the app is running in standalone mode
            const isInStandaloneMode = () =>
                (window.matchMedia('(display-mode: standalone)').matches) || (window.navigator.standalone) || document.referrer.includes('android-app://');

            if (isInStandaloneMode()) {
                console.log("webapp is installed")
            }
            else {
                console.log("webapp is not installed")
            }

            // Solution 3: Check if the app is running in standalone mode
        
            let hasPWA = window.location.href.includes(`PWA`);
            if(hasPWA){
                let paramStrign = window.location.href.split("?")[1]; // `mode=standalone`
                let queryString = new URLSearchParams(paramStrign);
                for (let pair of queryString.entries()) {
                    console.log("Key is: " + pair[0]);
                    console.log("Value is: " + pair[1]);

                    if (pair[0] == "mode") {
                        if (pair[1] == "standalone") {
                            console.log("PWA standalone", window.location.href)
                        }
                    }
                }
            }
            else{
                console.log("PWA not standalone", window.location.href);
            }

            window.isInStandaloneMode = hasPWA || isInStandaloneMode() || displayMode == 'standalone';
            console.log("window.isInStandaloneMode", window.isInStandaloneMode);

            // Check params in URL
            // example link
            //https://kinder-maxi-beta.g4b.gameloft.com/callback?code=9129588b-de12-4989-bda2-e5e467d6af2e
            let hasCode = window.location.href.includes(`callback`);
            let paramStrign = window.location.href.split("?")[1];
            if (hasCode && paramStrign) {
                let queryString = new URLSearchParams(paramStrign);
                for (let pair of queryString.entries()) {
                    console.log("Key is: " + pair[0]);
                    console.log("Value is: " + pair[1]);

                    if (pair[0] == CODE_NAME) {
                        if (window.opener) {
                            window.opener.postMessage(
                                { command: SNS_LOGIN_CODE, code: pair[1] },
                                targetOrigin
                            );
                        } else {
                            console.log("window.opener null");
                        }
                    }
                }
            }

            // QR CODE DETECT
            var ScannedQRCode = "";
            var TimeQRCode = "";
            let hasQRCode = false;

            // example link
            // https://kinder-maxi-alpha.g4b.gameloft.com/KM001?code=1668528932685
            let urlSplit = window.location.href.split("?");
            if (urlSplit.length > 1) {
                hasQRCode = true;

                package_name = mTracking.GetPackageName(urlSplit[0]); // KM001
                console.log("package name ", package_name);

                let timeCodeParams = urlSplit[1]; // code=1668528932685
                if (hasQRCode && timeCodeParams && timeCodeParams != "") {
                    ScannedQRCode = package_name;
                    console.log("QR CODE DETECTED ", ScannedQRCode);

                    let queryString = new URLSearchParams(timeCodeParams);
                    for (let pair of queryString.entries()) {
                        console.log("Key is: " + pair[0]);
                        console.log("Value is: " + pair[1]);

                        if (pair[0] == QR_CODE_NAME) {
                            TimeQRCode = pair[1];
                            launch_source = "425981"; // Scan QR
                            console.log("TIME QR CODE DETECTED ", TimeQRCode);
                        }
                    }
                } else {
                    console.log("NO QR CODE DETECTED");
                }
            } else {
            }

            // INVITE CODE DETECT
            var InvitedCode = "";
            let hasInviteCode = window.location.href.includes("invcode");
            let inviteCode = window.location.href.split("?")[1];
            if (hasInviteCode && inviteCode && inviteCode != "") {
                let queryString = new URLSearchParams(inviteCode);
                for (let pair of queryString.entries()) {
                    if (pair[0] == INVITE_CODE_NAME) {
                        InvitedCode = pair[1];
                        console.log("INVITE CODE DETECTED ", InvitedCode);
                    }
                }
            } else {
                console.log("NO INVITE CODE DETECTED");
            }

            // FB LINK DETECT
            let fbValue = "";
            let isFbLink = window.location.href.includes(FB_CODE_NAME);
            let fbParams = window.location.href.split("?")[1];
            if (isFbLink && fbParams && fbParams != "") {
                let queryString = new URLSearchParams(fbParams);
                for (let pair of queryString.entries()) {
                    if (pair[0] == FB_CODE_NAME) {
                        fbValue = pair[1];
                        console.log("FB CODE DETECTED ", fbValue);

                        if (fbValue == "1") {
                            launch_source = "425980"; // Facebook
                        }
                    }
                }
            } else {
                console.log("NO FB CODE DETECTED");
            }

            // YTB LINK DETECT
            let ytbValue = "";
            let isYtbLink = window.location.href.includes(YTB_CODE_NAME);
            let ytbParams = window.location.href.split("?")[1];
            if (isYtbLink && ytbParams && ytbParams != "") {
                let queryString = new URLSearchParams(ytbParams);
                for (let pair of queryString.entries()) {
                    if (pair[0] == YTB_CODE_NAME) {
                        ytbValue = pair[1];
                        console.log("YTB CODE DETECTED ", ytbValue);

                        if (ytbValue == "1") {
                            launch_source = "444171"; // Youtube
                        }
                    }
                }
            } else {
                console.log("NO YTB CODE DETECTED");
            }

            var cmsPhase = "BETA"; // BETA - GOLD
            var omsVersion = "0.1.8C"; // GAME VERSION
            var ggi = mTracking.GetGGI();
            var apiUrl = mTracking.GetApiUrl();
            var campaign_id = "";
            var creative_id = "";

            var uuid = mTracking.m_uuid;
            var session_id = mTracking.m_session_id;
            var visit_id = mTracking.m_visit_id;
            var ip_country = mTracking.m_ip_country;
            var mgp_code = mTracking.m_mgp_code;
            var ident_id = mTracking.m_ident_id;
            // var os = mTracking.m_os;
            // var game_name = mTracking.m_pack_name;
            var game_name = package_name;
            mTracking.m_launch_source = launch_source;
            mTracking.m_omsVersion = omsVersion;

            var time_between_session = mTracking.time_between_session;

            var start_time_loading = new Date().getTime();
            var total_time_interrupt = 0;
            var time_interrupt = 0;
            window.is_interrupt = false;
            document.addEventListener("visibilitychange", function () {
                if (document.visibilityState == "visible") {
                    window.is_interrupt = false;
                    let current_time = new Date().getTime();
                    let timer = current_time - time_interrupt;
                    total_time_interrupt += timer;
                    console.log("time_interrupt = " + timer);
                    console.log(
                        "total_time_interrupt = " + total_time_interrupt
                    );
                    console.log("==============================");
                } else {
                    window.is_interrupt = true;
                    time_interrupt = new Date().getTime();
                    console.log("==============================");
                }
            });

            // var token = mTracking.m_token;
            // end code

            //check for Navigation Timing API support
            if (window.performance) {
                console.info("window.performance works fine on this browser");
            }
            console.info(performance.navigation.type);
            if (
                performance.navigation.type ==
                performance.navigation.TYPE_RELOAD
            ) {
                console.info("This page is reloaded");
            } else {
                console.info("This page is not reloaded");
            }

        
            // orientation check
            var popupShown = false;
            var gameLoaded = false;
            let isUnsupportedBrowser = false;

            var LOCS_ORIENT = {
                en: {
                    Title: `The mini-game only supports landscape mode.`,
                },
                de: {
                    Title: `Das Mini-Spiel kann nur im Hochformat gespielt werden.`,
                },
                fr: {
                    Title: `Le mini-jeu ne prend en charge que le mode Portrait.`,
                },
                ru: {
                    Title: `Мини-игра поддерживает только портретный режим.`,
                },
                ar: {
                    Title: `تدعم هذه اللعبة المصغرة الوضع الرأسي فقط.`,
                },
            };

            var LOCS_BROWSER = {
                en: {
                    Title: `Unsupported Browser`,
                },
                de: {
                    Title: `Unsupported Browser`,
                },
                fr: {
                    Title: `Unsupported Browser`,
                },
                ru: {
                    Title: `Unsupported Browser`,
                },
                ar: {
                    Title: `Unsupported Browser`,
                },
            }

            function getBrowserLanguage() {
                return navigator.language || navigator.userLanguage;
            }

            function isMobile() {
                const toMatch = [
                    /Android/i,
                    /webOS/i,
                    /iPhone/i,
                    /iPad/i,
                    /iPod/i,
                    /BlackBerry/i,
                    /Windows Phone/i,
                ];

                return toMatch.some((toMatchItem) => {
                    return navigator.userAgent.match(toMatchItem);
                });
            }

            function showUnsupportedBrowser() {
                var popup = document.getElementById("wrapPopup");
                popup.style.display = "block";
                popupShown = true;
            }

            function showUnsupportedPopup(value) {  
                if (!isMobile() || isUnsupportedBrowser) return;

                var popup = document.getElementById("wrapPopup");
                if (value == true) {
                    popup.style.display = "block";
                    popupShown = true;
                } else {
                    popup.style.display = "none";
                    popupShown = false;
                }
                this.checkPopupOrientation();
            }

            console.log("window.UAbrowsername", window.UAbrowsername);

            let isSafari = window.UAbrowsername.indexOf("Safari") != -1;
            let isChrome = window.UAbrowsername.indexOf("Chrome") != -1;
            // let isYandex = window.UAbrowsername.indexOf("Yandex") != -1;
            let isOpera = window.UAbrowsername.indexOf("Opera") != -1;
            let isEdge = window.UAbrowsername.indexOf("Edge") != -1;
            let isFirefox = window.UAbrowsername.indexOf("Firefox") != -1;
            const browserList = [
                "Yandex",
                "UCBrowser",
                "DuckDuckGo",
                "MXiOS",
                "AlohaBrowser",
                "Puffin",
                "Maxthon",
                "Samsung Browser",
                "Zalo",
                "FBAN",
                "FBAV",
                "Instagram",
            ];
            browserList.forEach((br) => {
                if (navigator.userAgent.indexOf(br) != -1) {
                    isUnsupportedBrowser = true;
                }
            });
            if (
                isUnsupportedBrowser ||
                !(
                    isSafari ||
                    isChrome ||
                    isOpera ||
                    isEdge ||
                    isFirefox
                )
            ) {
                showUnsupportedBrowser();
            }

            function updateLocalization() {
                const langPrefix = this.getBrowserLanguage().split("-")[0];
                // var loc = LOCS_ORIENT.ru;

                if (isUnsupportedBrowser) {
                    loc = LOCS_BROWSER.en;
                } else {
                    switch(langPrefix) {
                        case "en":
                            loc = LOCS_ORIENT.en;
                            break;
                        case "de":
                            loc = LOCS_ORIENT.de;
                            break;
                        case "fr":
                            loc = LOCS_ORIENT.fr;
                            break;
                        case "ru":
                            loc = LOCS_ORIENT.ru;
                            break;
                        case "ar":
                            loc = LOCS_ORIENT.ar;
                            break;
                        default:
                            loc = LOCS_ORIENT.en;
                            break;
                    }

                    // if (langPrefix === "en") {
                    //     loc = LOCS_ORIENT.en;
                    // }
                }

                let title = document.getElementById("popup-title");
                if (title) {
                    title.innerHTML = loc.Title.toUpperCase();
                }
                // let description = document.getElementById("popup-description");
                // if (description) {
                //     description.innerHTML = loc.Description;
                // }
                // let buttonText = document.getElementById("button-text");
                // if (buttonText) {
                //     buttonText.innerHTML = loc.Button.toUpperCase();
                // }
            }

            orientationPopup = document.getElementById("popup");
            function checkPopupOrientation() {
                setTimeout(() => {
                    if(!orientationPopup){
                        orientationPopup = document.getElementById("popup");
                    }
                    // let scale = window.innerHeight / 1334;
                    if (window.innerWidth <= window.innerHeight) {
                        // you're in PORTRAIT mode
                        showUnsupportedPopup(false);
                    } else if (window.innerWidth > window.innerHeight && window.innerWidth / window.innerHeight > 1.5) {
                        // you're in LANDSCAPE mode
                        showUnsupportedPopup(true);
                    }

                    // popup.style.transform = `translate(-50%, -50%) scale(${scale}, ${scale})`;
                }, 250);
            }
            window.addEventListener(
                "orientationchange",
                this.checkPopupOrientation
            );

            checkPopupOrientation();
            updateLocalization();

            window.onresize = ()=>{ 
                console.log(`resize : ${window.innerWidth} , ${window.innerHeight}`); 
            }

            window.qualified_for_progressive_web_app = false;
            let deferred_prompt;

            const CHROME_PWA_PROHIBITED_MODELS = function () {
                if (isChrome()) {
                    let models = /SM-G95[05]/;
                    return models.test(navigator.userAgent);
                }

                return false;
            };

            if ('serviceWorker' in navigator) {
                let swurl = window.location.href.includes('test') ? '/test/sw.js' : '/sw.js';
                navigator.serviceWorker
                    .register(swurl)
                    .then(() => { console.log('Service Worker Registered', swurl); });
            }
            else{
                console.log('Service Worker Register Failed'); 
            }

            window.addEventListener("beforeinstallprompt", function (e) {
                console.log("beforeinstallprompt", e);
                e.preventDefault();
                // if (CHROME_PWA_PROHIBITED_MODELS()) {
                //     return;
                // }
                deferred_prompt = e;
                window.qualified_for_progressive_web_app = true;
            });

            window.addEventListener("confirm_install_app", function (e) {
                console.log("confirm_install_app", e);
                if (deferred_prompt) {
                    deferred_prompt.prompt();
                    window.qualified_for_progressive_web_app = false;
                }
            });

            window.addEventListener("appinstalled", function () {
                console.log("appinstalled");
                deferred_prompt = null;
                window.qualified_for_progressive_web_app = false;
            });

           

        </script>
        
<script src="./vconsole.min.js"></script>
<script type="text/javascript">
    // open web debugger console
    window.VConsole && (window.vConsole = new VConsole());
</script>

<!-- Polyfills bundle. -->
<script src="src/polyfills.bundle.5adbf.js" charset="utf-8"> </script>

<!-- SystemJS support. -->
<script src="src/system.bundle.692e9.js" charset="utf-8"> </script>

<!-- Import map -->
<script src="src/import-map.9e8f1.json" type="systemjs-importmap" charset="utf-8"> </script>

<script>
    System.import('./index.58c4f.js').catch(function(err) { console.error(err); })
</script>

    </body>
</html>
